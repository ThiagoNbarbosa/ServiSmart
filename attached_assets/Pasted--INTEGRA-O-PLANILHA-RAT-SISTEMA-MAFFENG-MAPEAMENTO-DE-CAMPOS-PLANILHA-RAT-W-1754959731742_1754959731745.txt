# ğŸ”— INTEGRAÃ‡ÃƒO PLANILHA RAT â†’ SISTEMA MAFFENG

## ğŸ“Š MAPEAMENTO DE CAMPOS

### PLANILHA RAT â†’ WORK ORDERS
```
A1: ELABORADOR DE RELATÃ“RIO    â†’ report_creator_id (FK)
B1: DATA LEVANTAMENTO          â†’ survey_date
C1: CONTRATO                   â†’ contract_number
D1: OS                         â†’ work_order_number
E1: PREFIXO                    â†’ equipment_prefix
F1: AGÃŠNCIA                    â†’ agency_name
G1: VALOR RAT ORÃ‡AMENTO        â†’ rat_budget_value
H1: VENCIMENTO PORTAL          â†’ portal_deadline
I1: SITUAÃ‡ÃƒO                   â†’ situation_status
J1: TÃ‰CNICO PREVENTIVA         â†’ preventive_technician_id (FK)
K1: DATA AGENDAMENTO           â†’ scheduled_date
L1: DIFICULDADES               â†’ difficulties_notes
M1: STATUS                     â†’ execution_status
```

## ğŸ—„ï¸ ESTRUTURA DE BANCO SUGERIDA

### Tabela: `work_orders_rat`
```sql
CREATE TABLE work_orders_rat (
    id SERIAL PRIMARY KEY,
    report_creator_id INT REFERENCES technicians(id),
    survey_date DATE,
    contract_number VARCHAR(50),
    work_order_number VARCHAR(50) UNIQUE,
    equipment_prefix VARCHAR(20),
    agency_name VARCHAR(100),
    rat_budget_value DECIMAL(10,2),
    portal_deadline DATE,
    situation_status VARCHAR(50),
    preventive_technician_id INT REFERENCES technicians(id),
    scheduled_date DATE,
    scheduled_status VARCHAR(20) DEFAULT 'AGENDADO', -- 'AGENDADO' ou 'EXECUTANDO'
    difficulties_notes TEXT,
    execution_status VARCHAR(20),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Enums Sugeridos
```sql
-- Status de SituaÃ§Ã£o
CREATE TYPE situation_status_enum AS ENUM (
    'ENVIADA_ORCAMENTO',
    'FORNECEDOR_ACIONADO',
    'LEVANTAMENTO_OK',
    'ORCAMENTO_APROVADO_RETORNO_FORNECEDOR',
    'RETORNO_FORNECEDOR',
    'SERVICO_CONCLUIDO',
    'SERVICO_CONCLUIDO_PENDENTE_RELATORIO'
);

-- Status de ExecuÃ§Ã£o
CREATE TYPE execution_status_enum AS ENUM (
    'ABERTA',
    'CONCLUIDA',
    'PARCIAL'
);

-- Status de Agendamento
CREATE TYPE scheduling_status_enum AS ENUM (
    'AGENDADO',
    'EXECUTANDO'
);
```

## ğŸ”§ IMPLEMENTAÃ‡ÃƒO NO FRONTEND

### 1. Atualizar PÃ¡gina Work Orders
**Arquivo**: `client/src/pages/work-orders.tsx`

```typescript
// Adicionar ao formato de importaÃ§Ã£o existente
const RAT_IMPORT_FORMAT = {
  A: "ELABORADOR DE RELATÃ“RIO",
  B: "DATA LEVANTAMENTO", 
  C: "CONTRATO",
  D: "OS",
  E: "PREFIXO",
  F: "AGÃŠNCIA",
  G: "VALOR RAT ORÃ‡AMENTO",
  H: "VENCIMENTO PORTAL",
  I: "SITUAÃ‡ÃƒO",
  J: "TÃ‰CNICO PREVENTIVA",
  K: "DATA AGENDAMENTO", 
  L: "DIFICULDADES",
  M: "STATUS"
};
```

### 2. Novo Componente: RAT Import Modal
**Arquivo**: `client/src/components/RATImportModal.tsx`

```typescript
interface RATImportModalProps {
  isOpen: boolean;
  onClose: () => void;
  onImport: (data: RATData[]) => void;
}

const RATImportModal = ({ isOpen, onClose, onImport }: RATImportModalProps) => {
  // LÃ³gica especÃ­fica para importaÃ§Ã£o RAT
  // ValidaÃ§Ã£o dos campos obrigatÃ³rios
  // Preview dos dados antes da importaÃ§Ã£o
};
```

### 3. ValidaÃ§Ã£o com Zod
```typescript
const RATImportSchema = z.object({
  responsibleTechnician: z.string().min(1, "ResponsÃ¡vel tÃ©cnico obrigatÃ³rio"),
  surveyDate: z.date(),
  contractNumber: z.string().optional(),
  workOrderNumber: z.string().min(1, "NÃºmero da OS obrigatÃ³rio"),
  equipmentPrefix: z.string().optional(),
  agencyName: z.string().min(1, "Nome da agÃªncia obrigatÃ³rio"),
  ratValue: z.number().positive("Valor deve ser positivo"),
  portalDeadline: z.date(),
  situationStatus: z.enum([...situation_status_options]),
  preventiveTechnician: z.string().optional(),
  scheduledDate: z.date().optional(),
  difficultiesNotes: z.string().optional(),
  executionStatus: z.enum(["ABERTA", "CONCLUIDA", "PARCIAL"])
});
```

## ğŸš€ IMPLEMENTAÃ‡ÃƒO NO BACKEND

### 1. Nova Rota de ImportaÃ§Ã£o RAT
**Arquivo**: `server/routes/work-orders.ts`

```typescript
// POST /api/work-orders/import-rat
router.post('/import-rat', upload.single('file'), async (req, res) => {
  try {
    const workbook = XLSX.read(req.file.buffer);
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    const rawData = XLSX.utils.sheet_to_json(worksheet);
    
    // Mapear dados da planilha para formato do sistema
    const mappedData = rawData.map(row => mapRATData(row));
    
    // Validar dados
    const validatedData = mappedData.map(data => 
      RATImportSchema.parse(data)
    );
    
    // Inserir no banco
    const result = await db.insert(workOrdersRAT).values(validatedData);
    
    res.json({ success: true, imported: result.length });
  } catch (error) {
    res.status(400).json({ error: error.message });
  }
});
```

### 2. FunÃ§Ã£o de Mapeamento
```typescript
const mapRATData = (row: any) => ({
  responsibleTechnician: row['RESPONSÃVEL TÃ‰CNICO'],
  surveyDate: parseDate(row['DATA LEVANTAMENTO']),
  contractNumber: row['CONTRATO'],
  workOrderNumber: row['OS'],
  equipmentPrefix: row['PREFIXO'],
  agencyName: row['AGÃŠNCIA'],
  ratValue: parseFloat(row['VALOR RAT']),
  portalDeadline: parseDate(row['VENCIMENTO PORTAL']),
  situationStatus: normalizeSituationStatus(row['SITUAÃ‡ÃƒO']),
  preventiveTechnician: row['TÃ‰CNICO PREVENTIVA'],
  scheduledDate: parseScheduledDate(row['DATA AGENDAMENTO']),
  difficultiesNotes: row['DIFICULDADES'],
  executionStatus: row['STATUS EXECUÃ‡ÃƒO']
});
```

## ğŸ“Š NOVA PÃGINA: RAT MANAGEMENT

### Estrutura da PÃ¡gina
```
/rat-management
â”œâ”€â”€ Header com estatÃ­sticas
â”œâ”€â”€ Filtros (por agÃªncia, status, tÃ©cnico)
â”œâ”€â”€ Tabela com dados RAT
â”œâ”€â”€ Modal de detalhes
â””â”€â”€ AÃ§Ãµes em lote
```

### Funcionalidades
- âœ… ImportaÃ§Ã£o de planilhas RAT
- âœ… VisualizaÃ§Ã£o em tabela
- âœ… Filtros avanÃ§ados
- âœ… ExportaÃ§Ã£o de relatÃ³rios
- âœ… Acompanhamento de prazos
- âœ… NotificaÃ§Ãµes de vencimento
- âœ… Dashboard especÃ­fico RAT

## ğŸ¯ PRÃ“XIMOS PASSOS

### Fase 1: Core Implementation
1. Criar estrutura de banco
2. Implementar importaÃ§Ã£o RAT
3. Criar pÃ¡gina RAT Management
4. Testes de importaÃ§Ã£o

### Fase 2: Features AvanÃ§adas
1. Dashboard RAT especÃ­fico
2. NotificaÃ§Ãµes automÃ¡ticas
3. RelatÃ³rios avanÃ§ados
4. IntegraÃ§Ã£o com sistema existente

### Fase 3: OtimizaÃ§Ãµes
1. ValidaÃ§Ãµes em tempo real
2. Preview de importaÃ§Ã£o
3. HistÃ³rico de alteraÃ§Ãµes
4. APIs para integraÃ§Ã£o externa

## ğŸ” CONSIDERAÃ‡Ã•ES TÃ‰CNICAS

### Performance
- ImportaÃ§Ã£o em lotes para arquivos grandes
- IndexaÃ§Ã£o em campos de busca frequente
- Cache de consultas complexas

### SeguranÃ§a
- ValidaÃ§Ã£o rigorosa de dados
- SanitizaÃ§Ã£o de inputs
- Logs de auditoria

### UX/UI
- Feedback visual durante importaÃ§Ã£o
- Estados de loading apropriados
- Mensagens de erro claras
- Preview antes da importaÃ§Ã£o final